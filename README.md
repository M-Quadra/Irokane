# Irokane

移植torch模型时被CoreML各种报错与龟速推理难到了。

一开始在原始网络上强行修改，虽然性能感人，但好歹跑起来了。突发奇想要是coremltools能自动适配不用修改一键转换该多好，翻了下积攒的变更日志，看看哪些能挑出来推给上游，顺便水PR。

然后，有些op直接锁死 CPU-only，模型一旦降回CPU就回不去辣。麻了，如果最终锁死CPU，解决转换问题的等价替换纯属自欺欺人。MIL Ops文档完全没有op细节，还被Xcode 16预告会显示op无法加速原因给骗了，甚至有直接隐藏 CPU-only op的bug，血压暴涨。

好累，不想爱了。

> 不行，云老婆就是我所有的爱。

思来想去只能手动拆模型，CPU only部分使用MPS重写。

随缘开发，但愿后面有空测试下各方案的实践情况。

精神状态不佳，似有太监可能。



对于非固定shape，究竟是每步操作独立，降低单次计算图编译代价快？还是尽可能构建完整计算图编译后再执行快？

花时间把2条路都肝一遍？（肝不动，没时间。

x86 mac某些op运行有问题，不知后续是否会碰到更多。唉，想换arm mac。（钱包：不，你不想。



考虑移除卷积支持，权重加载还未考虑好如何设计。



- 动态图模式

  初见宣传觉饼香，上手立刻就骂娘。

  MLTensor 看起来像 BNNS 封装，op支持有限。MPS op支持更好，但如此实现 IO 代价太高。

  预想的调试优点无法覆盖高额人力成本。庸碌如我，无法搞定。

  func 干扰太难受，有余力再开新坑。

- 静态图模式

  MPS计算图构建DSL，基于torch。

  原始方法太难用，权重加载还未考虑好，目前只作为 CoreML 补充，先这样吧。

- [名字没想好](./Doc/CoreML.md)（针对coremltools的实现替换）

  类似速查手册，可能完全不实现。

  替换后也是一个一个一个 CPU-only，那不白替换了？



